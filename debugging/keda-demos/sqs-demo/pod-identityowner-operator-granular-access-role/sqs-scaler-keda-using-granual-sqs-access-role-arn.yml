---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: nginxdemo-sqs-granual-access-sa
  namespace: keda
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::545444110299:role/keda-operator-sqs-granual-access-role-tig6351
---

apiVersion: keda.sh/v1alpha1
kind: TriggerAuthentication
metadata:
  name: sqs-pod-identityowner-trigger-auth
spec:
  podIdentity:
    provider: aws # aws IRSA , KEDA operator to use sqs-granual-access-role instead of keda-operator role
    roleArn: "arn:aws:iam::545444110299:role/keda-operator-sqs-granual-access-role-tig6351"
    identityOwner: keda 

---
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: sqsconsumer-hpa
spec:
  scaleTargetRef:
    name: nginx-deployment-pod-sa
  minReplicaCount: 0
  maxReplicaCount: 10
  pollingInterval: 10 
  cooldownPeriod:  10 
  triggers:
  - type: aws-sqs-queue
    metadata:
      queueURL: https://sqs.us-east-1.amazonaws.com/545444110299/keda_poc_queue
      activationQueueLength: "0"
      queueLength: "2"
      awsRegion: us-east-1
      identityOwner: pod
    authenticationRef:
      name: "sqs-pod-identityowner-trigger-auth"
